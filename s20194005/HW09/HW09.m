nx =9;
ny =5;

A1= zeros(45,45); A2= zeros(45,45); A3= zeros(45,45); A4= zeros(45,45);
b1= zeros(45,1); b2= zeros(45,1); b3= zeros(45,1); b4= zeros(45,1);
S1=0; D1=1; Body1=0;
S2=1; D2=0; Body2=0;
S3=0; D3=0; Body3=1;
S4=1; D4=1; Body4=1;

for i= 1:9
    b1(i,1)=Body1; b2(i,1)=Body2; b3(i,1)=Body3; b4(i,1)=Body4;
    b1(4*nx+1,1)=S1;  b2(4*nx+1,1)=S2; b3(4*nx+1,1)=S3; b4(4*nx+1,1)=S4;
    b1(4*nx+2,1)=S1;  b2(4*nx+2,1)=S2; b3(4*nx+2,1)=S3; b4(4*nx+2,1)=S4;
    b1(4*nx+8,1)=D1;  b2(4*nx+8,1)=D2; b3(4*nx+8,1)=D3; b4(4*nx+8,1)=D4;
    b1(4*nx+9,1)=D1;  b2(4*nx+9,1)=D2; b3(4*nx+9,1)=D3; b4(4*nx+9,1)=D4;
end

for i=2:8
    for j=2:4
        A1((j-1)*nx+i,(j-1)*nx+i+1) =1; A2((j-1)*nx+i,(j-1)*nx+i-1) =1; A3((j-1)*nx+i,(j-1)*nx+i-1) =1; A4((j-1)*nx+i,(j-1)*nx+i-1) =1;
        A1((j-1)*nx+i,(j)*nx+i) =1; A2((j-1)*nx+i,(j)*nx+i) =1; A3((j-1)*nx+i,(j)*nx+i) =1; A4((j-1)*nx+i,(j)*nx+i) =1;
        A1((j-1)*nx+i,(j-1)*nx+i) =-4; A2((j-1)*nx+i,(j-1)*nx+i) =-4; A3((j-1)*nx+i,(j-1)*nx+i) =-4; A4((j-1)*nx+i,(j-1)*nx+i) =-4;
        A1((j-1)*nx+i,(j-1)*nx+i-1) =1;  A2((j-1)*nx+i,(j-1)*nx+i-1) =1;  A3((j-1)*nx+i,(j-1)*nx+i-1) =1;  A4((j-1)*nx+i,(j-1)*nx+i-1) =1;
        A1((j-1)*nx+i,(j-2)*nx+i) =1; A2((j-1)*nx+i,(j-2)*nx+i) =1; A3((j-1)*nx+i,(j-2)*nx+i) =1; A4((j-1)*nx+i,(j-2)*nx+i) =1;
    end
end
for j=2:4
    A1((j-1)*nx+1,(j-1)*nx+2) =1; A2((j-1)*nx+1,(j-1)*nx+2) =1; A3((j-1)*nx+1,(j-1)*nx+2) =1; A4((j-1)*nx+1,(j-1)*nx+2) =1;
    A1((j-1)*nx+1,(j-1)*nx+1) =-2; A2((j-1)*nx+1,(j-1)*nx+1) =-2; A3((j-1)*nx+1,(j-1)*nx+1) =-2; A4((j-1)*nx+1,(j-1)*nx+1) =-2;
    A1((j-1)*nx+1,(j)*nx+1) =0.5; A2((j-1)*nx+1,(j)*nx+1) =0.5; A3((j-1)*nx+1,(j)*nx+1) =0.5; A4((j-1)*nx+1,(j)*nx+1) =0.5;
    A1((j-1)*nx+1,(j-2)*nx+1) =0.5; A2((j-1)*nx+1,(j-2)*nx+1) =0.5; A3((j-1)*nx+1,(j-2)*nx+1) =0.5; A4((j-1)*nx+1,(j-2)*nx+1) =0.5;
    A1((j-1)*nx+9,(j-1)*nx+8) =1; A2((j-1)*nx+9,(j-1)*nx+8) =1; A3((j-1)*nx+9,(j-1)*nx+8) =1; A4((j-1)*nx+9,(j-1)*nx+8) =1;
    A1((j-1)*nx+9,(j-1)*nx+9) =-2;  A2((j-1)*nx+9,(j-1)*nx+9) =-2;  A3((j-1)*nx+9,(j-1)*nx+9) =-2;  A4((j-1)*nx+9,(j-1)*nx+9) =-2;
    A1((j-1)*nx+9,(j)*nx+9) =0.5; A2((j-1)*nx+9,(j)*nx+9) =0.5; A3((j-1)*nx+9,(j)*nx+9) =0.5; A4((j-1)*nx+9,(j)*nx+9) =0.5;
    A1((j-1)*nx+9,(j-2)*nx+9) =0.5; A2((j-1)*nx+9,(j-2)*nx+9) =0.5; A3((j-1)*nx+9,(j-2)*nx+9) =0.5; A4((j-1)*nx+9,(j-2)*nx+9) =0.5;
end



for j=1:9
     A1(0*nx+j,0*nx+j)=1; A2(0*nx+j,0*nx+j)=1; A3(0*nx+j,0*nx+j)=1; A4(0*nx+j,0*nx+j)=1;
     A1(4*nx+j,4*nx+j)=1; A2(4*nx+j,4*nx+j)=1; A3(4*nx+j,4*nx+j)=1; A4(4*nx+j,4*nx+j)=1;
end

x1=A1\b1; x2=A2\b2; x3=A3\b3; x4=A4\b4;
for j=1:5
    for i=1:9
        z1(i,j) = x1((j-1)*9+i,1);
        z2(i,j) = x2((j-1)*9+i,1);
        z3(i,j) = x3((j-1)*9+i,1);
        z4(i,j) = x4((j-1)*9+i,1);
    end
end
surf(z1);
